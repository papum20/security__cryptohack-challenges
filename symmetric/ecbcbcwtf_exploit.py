from requests import get
from pwn import xor


URL = 'https://aes.cryptohack.org/ecbcbcwtf/'
URL_ENC = f'{URL}encrypt_flag/'
def URL_DEC(ciphertext):
    return f'{URL}decrypt/{ciphertext}/'

IV_FLAG = get(URL_ENC).json()['ciphertext']
iv = bytes.fromhex(IV_FLAG[:32])
flag_enc = bytes.fromhex(IV_FLAG[32:])
print(f'iv    = {iv.hex()}')
print(f'flag  = {flag_enc.hex()}')

# first block
flag0_dec = get(URL_DEC(flag_enc[:16].hex())).json()['plaintext']
flag0 = xor(iv, bytes.fromhex(flag0_dec))
print(f'flag0 = {flag0.hex()}')
print(f'flag0 = {flag0}')

# second block
flag1_dec = get(URL_DEC(flag_enc[16:32].hex())).json()['plaintext']
flag1 = xor(flag_enc[:16], bytes.fromhex(flag1_dec))
print(f'flag1 = {flag1.hex()}')
print(f'flag1 = {flag1}')

print(f'flag  = {flag0 + flag1}')