from requests import get
from pwn import xor


BLOCK_SIZE = 16
FLAG_BLOCKS = 3

URL = 'https://aes.cryptohack.org/symmetry/'
URL_ENC_FLAG = f'{URL}encrypt_flag/'
def URL_ENC(plaintext, iv):
	return f'{URL}encrypt/{plaintext}/{iv}/'


IV_FLAG = get(URL_ENC_FLAG).json()['ciphertext']
iv = bytes.fromhex(IV_FLAG[:32])
flag_enc = bytes.fromhex(IV_FLAG[32:])
print(f'iv    = {iv.hex()}')
print(f'flag  = {flag_enc.hex()}')

# get encrypted iv
pt = b'\x00' * BLOCK_SIZE * FLAG_BLOCKS
iv_enc = get(URL_ENC(pt.hex(), iv.hex())).json()['ciphertext']
iv_enc = bytes.fromhex(iv_enc)
print(f'iv_e  = {iv_enc.hex()}')

flag = xor(iv_enc, flag_enc)
print(f'flag  = {flag}')